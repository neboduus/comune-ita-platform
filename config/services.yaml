parameters:
  locale: 'it'
  google_recaptcha_site_key: '%env(GOOGLE_RECAPTCHA_SITE_KEY)%'

services:
  # default configuration for services in *this* file
  _defaults:
    autowire: true      # Automatically injects dependencies in your services.
    autoconfigure: true # Automatically registers your services as commands, event subscribers, etc.

  # makes classes in src/ available to be used as services
  # this creates a service per class whose id is the fully-qualified class name
  App\:
    resource: '../src/*'
    exclude: '../src/{DependencyInjection,Entity,Migrations,Tests,Kernel.php}'

  # controllers are imported separately to make sure services can be injected
  # as action arguments even if you don't extend any base controller class
  App\Controller\:
    resource: '../src/Controller'
    tags: ['controller.service_arguments']

  # add more service definitions when explicit configuration is needed
  # please note that last definitions always *replace* previous ones


  ## Stanzadelcittadino

  ocsdc.meeting_service:
    class: App\Services\MeetingService
    arguments:
      - '@doctrine.orm.entity_manager'
      - '@ocsdc.instance_service'
      - '@ocsdc.mailer'
      - '%default_from_email_address%'
      - '@translator'
      - '@router'

  ocsdc.meeting_eventlistener:
    class: App\EventListener\MeetingLifeCycleListener
    tags:
      - { name: doctrine.event_listener, event: postPersist, connection: default }
      - { name: doctrine.event_listener, event: preUpdate, connection: default }
      - { name: doctrine.event_listener, event: postRemove, connection: default }
    arguments:
      [ '@ocsdc.meeting_service' ]

  App\Controller\APIController:
    arguments: [ "@doctrine.orm.entity_manager", '@ocsdc.instance_service' ]

  App\Controller\Rest\ServicesAPIController:
    autowire: true

  App\Controller\Rest\ServicesGroupAPIController:
    autowire: true

  App\Controller\Rest\ApplicationsAPIController:
    autowire: true

  App\Controller\Rest\UsersAPIController:
    autowire: true

  App\Controller\Rest\CalendarsAPIController:
    arguments: [ "@doctrine.orm.entity_manager", '@ocsdc.instance_service', '@ocsdc.meeting_service' ]

  App\Controller\Rest\MeetingsAPIController:
    autowire: true
    arguments: [ "@translator" ]

  App\Controller\Rest\SubscriptionServicesAPIController:
    autowire: true

  App\Controller\Rest\FoldersAPIController:
    arguments: [ '@translator', '@doctrine.orm.entity_manager','@ocsdc.instance_service' ]

  App\Controller\Rest\DocumentsAPIController:
    arguments:
      [ "@translator", "%kernel.root_dir%", '@doctrine.orm.entity_manager', '@ocsdc.instance_service' ]

  App\Controller\PraticheAnonimeController:
    arguments:
      - '@logger'
      - "@translator"
      - "@ocsdc.pratica_status_service"
      - "@ocsdc.modulo_pdf_builder"
      - "@ocsdc.allegati.dematerialized_attacher"
      - '%hash_validity%'

  App\Controller\TrackingController:
    autowire: true

  #GuzzleHttp\Client: '@guzzle.client.mypay'

  App\Form\ApplicationMessageType:
    arguments: [ '@doctrine.orm.entity_manager' ]
    tags:
      - { name: form.type }

  App\Form\Scia\PraticaEdiliziaVincoliType:
    autowire: true
    tags:
      - { name: form.type }

  App\Form\OccupazioneSuoloPubblico\ImportoType:
    autowire: true
    tags:
      - { name: form.type }

  App\Form\OccupazioneSuoloPubblico\ImportoChecker:
    autowire: true

  App\Form\CalendarBackofficeType:
    arguments: [ "@doctrine.orm.default_entity_manager", "@translator" ]
    tags:
      - { name: form.type }

  App\Form\CalendarType:
    autowire: true
    tags:
      - { name: form.type }

  App\Form\MeetingType:
    arguments: [ "@doctrine.orm.entity_manager", '@ocsdc.meeting_service', '@translator' ]
    tags:
      - { name: form.type }

  App\Form\OpeningHourType:
    arguments:
      - "@translator"
      - "@doctrine.orm.entity_manager"
      - "@ocsdc.meeting_service"
    tags:
      - { name: form.type }

  App\Form\DocumentAPIType:
    arguments: [ "%kernel.root_dir%", '%allowed_extensions%' ]
    tags:
      - { name: form.type }

  App\Services\MyPayService:
    autowire: true

  App\Services\InstanceService:
    arguments: [ "@doctrine", "%prefix%" ]

  App\Payment\Gateway\Bollo:
    autowire: true

  App\Payment\Gateway\MyPay:
    autowire: true

  App\Validator\Constraints:
    autowire: true

  App\BackOffice\SubcriptionsBackOffice:
    arguments: [ "@logger","@translator","@doctrine.orm.entity_manager" ]
    public: true
    tags: [ 'app.backoffice' ]

  App\BackOffice\CalendarsBackOffice:
    arguments:
      - '@doctrine.orm.entity_manager'
      - '@ocsdc.instance_service'
      - '@ocsdc.meeting_service'
      - "@translator"
    public: true
    tags: [ 'app.backoffice' ]

  App\Services\BackOfficeCollection:
    arguments:
      - !tagged app.backoffice

  ocsdc.backoffices: '@App\Services\BackOfficeCollection'

  App\Controller\DocumentController:
    arguments: [ "@translator", "@doctrine.orm.default_entity_manager", "@logger" ]

  App\Controller\SubscriptionsController:
    autowire: true

  App\Controller\SubscriberController:
    autowire: true,
    arguments: [ "@ocsdc.mailer", "%default_from_email_address%", "@logger" ]

  App\Controller\CalendarsController:
    arguments:
      - "@translator"
      - '@doctrine.orm.entity_manager'
      - '@ocsdc.instance_service'
      - '@ocsdc.meeting_service'

  Vich\UploaderBundle\Naming\DirectoryNamerInterface: "@ocsdc.allegati.directory_namer"

  ocsdc.cps.userprovider:
    class: App\Services\CPSUserProvider
    arguments: [ "@doctrine.orm.default_entity_manager", "@logger" ]

  ocsdc.pat.authenticator:
    class: App\Security\PatAuthenticator
    arguments: [ "@router", "%shibbolet_server_varnames%", "%login_route%" ]

  ocsdc.openlogin.authenticator:
    class: App\Security\OpenLoginAuthenticator
    arguments: [ "@router", "%login_route%" ]

  ocsdc.cps.token_authenticator:
    class: App\Security\CPSAuthenticator
    arguments: [ "%shibbolet_server_varnames%",'@Symfony\Component\Security\Core\Security' ]

  ocsdc.cps.terms_acceptance_listener:
    class: App\EventListener\TermsAcceptListener
    arguments: [ "@router", "@security.token_storage", "@ocsdc.cps.terms_acceptance_checker" ]
    tags:
      - { name: kernel.event_listener, event: kernel.request, priority: -10 }

  ocsdc.cps.complete_profile_listener:
    class: App\EventListener\CompleteProfileListener
    arguments: [ "@router","@security.token_storage", "@ocsdc.cps.userprovider", "%PasswordLifeTime%" ]
    tags:
      - { name: kernel.event_listener, event: kernel.request, priority: -100 }

  ocsdc.redirect.after.login:
    class: App\Handlers\Auth\AfterLoginRedirection
    arguments: [ '@router','@security.authorization_checker' ]

  gedmo.listener.sluggable:
    class: Gedmo\Sluggable\SluggableListener
    tags:
      - { name: doctrine.event_subscriber, connection: default }
    calls:
      - [ setAnnotationReader, [ "@annotation_reader" ] ]

  monolog_processor:
    class: Monolog\Processor\PsrLogMessageProcessor
    tags:
      - { name: monolog.processor }

  ocsdc.form.flow.type_extension.help_data:
    class: App\Form\Extension\HelpDataTypeExtension
    arguments: [ "@translator", "%prefix%" ]
    tags:
      - { name: form.type_extension, alias: "form", extended_type: Symfony\Component\Form\Extension\Core\Type\FormType }

  ocsdc.allegati.directory_namer:
    class: App\Services\DirectoryNamerService

  ocsdc.allegati.mimetype_validator:
    class: App\Validator\Constraints\ValidMimeTypeValidator
    arguments: [ "@translator" ]
    tags:
      - { name: validator.constraint_validator }

  ocsdc.mailer:
    class: App\Services\MailerService
    arguments: [ "@mailer", "@translator", "@templating", "@doctrine", '@logger', '@router' ]


  App\Services\ModuloPdfBuilderService:
    arguments:
      - "@filesystem"
      - "@doctrine.orm.default_entity_manager"
      - "@translator"
      - "@vich_uploader.property_mapping_factory"
      - "@ocsdc.allegati.directory_namer"
      - "%wkhtmltopdf_service%"
      - "@templating"
      - "%ocsdc_default_datetime_format%"
      - "@router"
      - "%ez_password%"
      - '@ocsdc.pratica_status_service'
      - "@ocsdc.schedule_action_service"

  ocsdc.modulo_pdf_builder: '@App\Services\ModuloPdfBuilderService'

  ocsdc.protocollo.client: "@guzzle.client.protocollo_cct"

  ocsdc.protocollo.handler: "@ocsdc.protocollo.handlers.dummy"

  ocsdc.protocollo.handlers.dummy:
    class: App\Protocollo\DummyProtocolloHandler
    public: false

  ocsdc.protocollo.handlers.pec:
    class: App\Protocollo\PecProtocolloHandler
    public: false
    arguments:
      - "%pec_mailer_host%"
      - "%pec_mailer_port%"
      - "%pec_mailer_user%"
      - "%pec_mailer_password%"
      - "%pec_delivery_address%"
      - "@translator"
      - "@templating"
      - "@logger"


  ocsdc.protocollo.handlers.pitre:
    class: App\Protocollo\PiTreProtocolloHandler
    arguments: [ "@ocsdc.protocollo.client", "%prefix%" ]
    public: false

  ocsdc.protocollo.handlers.infor:
    class: App\Protocollo\InforProtocolloHandler
    autowire: true
    #        arguments: ["@doctrine.orm.entity_manager",'@logger', '@ocsdc.allegati.directory_namer',  '@vich_uploader.property_mapping_factory' ]
    public: false

  App\Services\DelayedProtocolloService:
    arguments: [ "@ocsdc.protocollo_direct","@doctrine.orm.entity_manager","@logger", "@ocsdc.schedule_action_service" ]

  App\Services\ProtocolloService:
    arguments: [ "@ocsdc.protocollo.handler","@doctrine.orm.entity_manager","@logger","@event_dispatcher" ]

  ocsdc.protocollo: '@App\Services\DelayedProtocolloService'
  ocsdc.protocollo_direct: '@App\Services\ProtocolloService'

  ocsdc.pratica_listeners.createpdf:
    class: App\EventListener\CreatePdfPraticaListener
    arguments: [ "@ocsdc.modulo_pdf_builder", "@logger" ]
    tags:
      - { name: kernel.event_listener, event: ocsdc.pratica.on_status_change, method: onStatusChange, priority: 10 }

  ocsdc.pratica_listeners.sendmail:
    class: App\EventListener\SendMailPraticaListener
    arguments: [ "@ocsdc.mailer", "%default_from_email_address%", "@logger" ]
    tags:
      - { name: kernel.event_listener, event: ocsdc.pratica.on_status_change, method: onStatusChange, priority: 20 }

  ocsdc.pratica_listeners.backoffice:
    class: App\EventListener\BackOfficePraticaListener
    arguments: [ "@service_container", "@logger" ]
    tags:
      - { name: kernel.event_listener, event: ocsdc.pratica.on_status_change, method: onStatusChange, priority: 30 }

  ocsdc.pratica_listeners.protocollo:
    class: App\EventListener\ProtocollaPraticaListener
    arguments: [ "@ocsdc.protocollo", "@ocsdc.pratica_status_service","@logger" ]
    tags:
      - { name: kernel.event_listener, event: ocsdc.pratica.on_status_change, method: onStatusChange, priority: 100 }

  ocsdc.form.flow.storage_key_generator:
    class: App\Form\UserSessionStorageKeyGenerator

  ocsdc.form.type.choose_allegato:
    class: App\Form\Base\ChooseAllegatoType
    arguments: [ "@doctrine.orm.entity_manager", "@validator" ]
    tags:
      - { name: form.type }

  ocsdc.form.type.upload_allegato:
    class: App\Form\Base\UploadAllegatoType
    arguments: [ "@doctrine.orm.entity_manager", "@validator" ]
    tags:
      - { name: form.type }

  ocsdc.form.type.signed_allegato:
    class: App\Form\Operatore\Base\SignedAllegatoType
    arguments: [ "@doctrine.orm.entity_manager", "@validator", "@ocsdc.p7m_signature_check" ]
    tags:
      - { name: form.type }

  ocsdc.form.type.scia_edilizia_modulo_scia_pratica_edilizia_type:
    class: App\Form\Scia\PraticaEdiliziaModuloSciaType
    arguments: [ "@doctrine.orm.entity_manager", "@validator", "@ocsdc.p7m_signature_check" ]
    tags:
      - { name: form.type }

  ocsdc.form.type.scia_edilizia_allegati_modulo_scia_pratica_edilizia_type:
    class: App\Form\Scia\PraticaEdiliziaAllegatiModuloSciaType
    arguments: [ "@doctrine.orm.entity_manager", "@validator", "@ocsdc.p7m_signature_check" ]
    tags:
      - { name: form.type }

  ocsdc.form.type.scia_ediliza_soggetti_type:
    class: App\Form\Scia\PraticaEdiliziaSoggettiType
    arguments: [ "@doctrine.orm.entity_manager", "@validator", "@ocsdc.p7m_signature_check" ]
    tags:
      - { name: form.type }

  ocsdc.form.type.scia_edilizia_allegati_tecnici_type:
    class: App\Form\Scia\PraticaEdiliziaAllegatiTecniciType
    arguments: [ "@doctrine.orm.entity_manager", "@validator", "@ocsdc.p7m_signature_check" ]
    tags:
      - { name: form.type }

  ocsdc.form.type.scia_edilizia_ulteriori_allegati_tecnici_type:
    class: App\Form\Scia\PraticaEdiliziaUlterioriAllegatiTecniciType
    arguments: [ "@doctrine.orm.entity_manager", "@validator", "@ocsdc.p7m_signature_check" ]
    tags:
      - { name: form.type }

  ocsdc.form.type.scia_edilizia_provvedimenti_type:
    class: App\Form\Scia\PraticaEdiliziaProvvedimentiType
    arguments: [ "@doctrine.orm.entity_manager", "@validator", "@ocsdc.p7m_signature_check" ]
    tags:
      - { name: form.type }

  ocsdc.form.type.select_payment_gateway_type:
    class: App\Form\Base\SelectPaymentGatewayType
    autowire: true
    tags:
      - { name: form.type }

  App\Form\FormIO\FormIORenderType:
    autowire: true
    tags:
      - { name: form.type }

  App\Form\Admin\Servizio\FormIOBuilderRenderType:
    autowire: true
    tags:
      - { name: form.type }

  App\Form\Admin\Servizio\FormIOTemplateType:
    autowire: true
    tags:
      - { name: form.type }

  App\Form\Base\PaymentGatewayType:
    autowire: true
    tags:
      - { name: form.type }

  App\Form\Admin\Servizio\PaymentDataType:
    autowire: true
    tags:
      - { name: form.type }

  App\Form\Admin\Servizio\FeedbackMessagesDataType:
    autowire: true
    tags:
      - { name: form.type }

  App\Form\Admin\Servizio\IntegrationsDataType:
    autowire: true
    arguments: [ "@translator" ]
    tags:
      - { name: form.type }

  App\Form\Admin\Servizio\ProtocolDataType:
    autowire: true
    tags:
      - { name: form.type }

  App\Form\Admin\Ente\EnteType:
    autowire: true
    tags:
      - { name: form.type }

  App\Form\SubscriptionServiceType:
    autowire: true
    tags:
      - { name: form.type }

  App\Form\OperatoreUserType:
    autowire: true
    tags:
      - { name: form.type }

  ocsdc.form.type.payment_gateway_type: '@App\Form\Base\PaymentGatewayType'

  ocsdc.form_flow_registry: '@App\Form\PraticaFlowRegistry'

  App\Form\PraticaFlowRegistry:
    autowire: true

  App\Form\Base\PraticaFlow:
    autowire: false
    autoconfigure: false
    parent: craue.form.flow
    arguments:
      - "@logger"
      - "@translator"
      - "@ocsdc.pratica_status_service"
      - "@ocsdc.modulo_pdf_builder"
      - "@ocsdc.allegati.dematerialized_attacher"
      - "%prefix%"
      - "@formio.factory"
      - "@doctrine.orm.entity_manager"

  ocsdc.form.flow.asilonido:
    autowire: false
    autoconfigure: false
    class: App\Form\IscrizioneAsiloNido\IscrizioneAsiloNidoFlow
    parent: App\Form\Base\PraticaFlow
    tags:
      - { name: ocsdc.pratica.flow, alias: ocsdc.form.flow.asilonido }

  ocsdc.form.flow.autoletturaacqua:
    autowire: false
    autoconfigure: false
    class: App\Form\AutoletturaAcqua\AutoletturaAcquaFlow
    parent: App\Form\Base\PraticaFlow
    tags:
      - { name: ocsdc.pratica.flow, alias: ocsdc.form.flow.autoletturaacqua }

  ocsdc.form.flow.iscrizioneregistroassociazioni:
    autowire: false
    autoconfigure: false
    class: App\Form\IscrizioneRegistroAssociazioni\IscrizioneRegistroAssociazioniFlow
    parent: App\Form\Base\PraticaFlow
    tags:
      - { name: ocsdc.pratica.flow, alias: ocsdc.form.flow.iscrizioneregistroassociazioni }

  ocsdc.form.flow.contributopannolini:
    autowire: false
    autoconfigure: false
    class: App\Form\ContributoPannolini\ContributoPannoliniFlow
    parent: App\Form\Base\PraticaFlow
    tags:
      - { name: ocsdc.pratica.flow, alias: ocsdc.form.flow.contributopannolini }

  ocsdc.form.flow.cambioresidenza:
    autowire: false
    autoconfigure: false
    class: App\Form\CambioResidenza\CambioResidenzaFlow
    parent: App\Form\Base\PraticaFlow
    tags:
      - { name: ocsdc.pratica.flow, alias: ocsdc.form.flow.cambioresidenza }

  ocsdc.form.flow.allacciamentoacquedotto:
    autowire: false
    autoconfigure: false
    class: App\Form\AllacciamentoAcquedotto\AllacciamentoAcquedottoFlow
    parent: App\Form\Base\PraticaFlow
    arguments: [ "@logger","@translator" ]
    tags:
      - { name: ocsdc.pratica.flow, alias: ocsdc.form.flow.allacciamentoacquedotto }

  ocsdc.form.flow.certificatonascita:
    autowire: false
    autoconfigure: false
    class: App\Form\CertificatoNascita\CertificatoNascitaFlow
    parent: App\Form\Base\PraticaFlow
    tags:
      - { name: ocsdc.pratica.flow, alias: ocsdc.form.flow.certificatonascita }

  ocsdc.form.flow.estrattonascita:
    autowire: false
    autoconfigure: false
    class: App\Form\EstrattoNascita\EstrattoNascitaFlow
    parent: App\Form\Base\PraticaFlow
    tags:
      - { name: ocsdc.pratica.flow, alias: ocsdc.form.flow.estrattonascita }

  ocsdc.form.flow.attonascita:
    autowire: false
    autoconfigure: false
    class: App\Form\AttoNascita\AttoNascitaFlow
    parent: App\Form\Base\PraticaFlow
    tags:
      - { name: ocsdc.pratica.flow, alias: ocsdc.form.flow.attonascita }

  ocsdc.form.flow.certificatomorte:
    autowire: false
    autoconfigure: false
    class: App\Form\CertificatoMorte\CertificatoMorteFlow
    parent: App\Form\Base\PraticaFlow
    tags:
      - { name: ocsdc.pratica.flow, alias: ocsdc.form.flow.certificatomorte }

  ocsdc.form.flow.estrattomorte:
    autowire: false
    autoconfigure: false
    class: App\Form\EstrattoMorte\EstrattoMorteFlow
    parent: App\Form\Base\PraticaFlow
    tags:
      - { name: ocsdc.pratica.flow, alias: ocsdc.form.flow.estrattomorte }

  ocsdc.form.flow.attomorte:
    autowire: false
    autoconfigure: false
    class: App\Form\AttoMorte\AttoMorteFlow
    parent: App\Form\Base\PraticaFlow
    tags:
      - { name: ocsdc.pratica.flow, alias: ocsdc.form.flow.attomorte }

  ocsdc.form.flow.certificatomatrimonio:
    autowire: false
    autoconfigure: false
    class: App\Form\CertificatoMatrimonio\CertificatoMatrimonioFlow
    parent: App\Form\Base\PraticaFlow
    tags:
      - { name: ocsdc.pratica.flow, alias: ocsdc.form.flow.certificatomatrimonio }

  ocsdc.form.flow.estrattomatrimonio:
    autowire: false
    autoconfigure: false
    class: App\Form\EstrattoMatrimonio\EstrattoMatrimonioFlow
    parent: App\Form\Base\PraticaFlow
    tags:
      - { name: ocsdc.pratica.flow, alias: ocsdc.form.flow.estrattomatrimonio }

  ocsdc.form.flow.attomatrimonio:
    autowire: false
    autoconfigure: false
    class: App\Form\AttoMatrimonio\AttoMatrimonioFlow
    parent: App\Form\Base\PraticaFlow
    tags:
      - { name: ocsdc.pratica.flow, alias: ocsdc.form.flow.attomatrimonio }

  #  ocsdc.form.flow.nullaostamatrimonio:
  #    class: App\Form\CertificatoAnagrafico\CertificatoAnagraficoFlow
  #    parent: App\Form\Base\PraticaFlow

  ocsdc.form.flow.attestazioneanagrafica:
    autowire: false
    autoconfigure: false
    class: App\Form\AttestazioneAnagrafica\AttestazioneAnagraficaFlow
    parent: App\Form\Base\PraticaFlow
    tags:
      - { name: ocsdc.pratica.flow, alias: ocsdc.form.flow.attestazioneanagrafica }

  ocsdc.form.flow.listeelettorali:
    autowire: false
    autoconfigure: false
    class: App\Form\ListeElettorali\ListeElettoraliFlow
    parent: App\Form\Base\PraticaFlow
    tags:
      - { name: ocsdc.pratica.flow, alias: ocsdc.form.flow.listeelettorali }

  ocsdc.form.flow.statofamiglia:
    autowire: false
    autoconfigure: false
    class: App\Form\StatoFamiglia\StatoFamigliaFlow
    parent: App\Form\Base\PraticaFlow
    tags:
      - { name: ocsdc.pratica.flow, alias: ocsdc.form.flow.statofamiglia }

  ocsdc.form.flow.formio:
    autowire: false
    autoconfigure: false
    class: App\Form\FormIO\FormIOFlow
    parent: App\Form\Base\PraticaFlow
    tags:
      - { name: ocsdc.pratica.flow, alias: ocsdc.form.flow.formio }

  # Inzio operatore

  ocsdc.form.flow.praticaoperatore:
    autowire: false
    autoconfigure: false
    class: App\Form\Operatore\Base\PraticaOperatoreFlow
    parent: craue.form.flow
    arguments: [ "@logger","@translator" ]

  ocsdc.form.flow.standardoperatore:
    autowire: false
    autoconfigure: false
    class: App\Form\Operatore\Standard\StandardOperatoreFlow
    parent: App\Form\Base\PraticaFlowoperatore

  ocsdc.form.flow.operatore.standardallegatonofirma:
    autowire: false
    autoconfigure: false
    class: App\Form\Operatore\Standard\StandardAllegatoNoFirmaFlow
    parent: App\Form\Base\PraticaFlowoperatore

  ocsdc.form.flow.certificatonascitaoperatore:
    autowire: false
    autoconfigure: false
    class: App\Form\Operatore\CertificatoNascita\CertificatoNascitaOperatoreFlow
    parent: App\Form\Base\PraticaFlowoperatore

  ocsdc.form.flow.attestazioneanagraficaoperatore:
    autowire: false
    autoconfigure: false
    class: App\Form\Operatore\AttestazioneAnagrafica\AttestazioneAnagraficaOperatoreFlow
    parent: App\Form\Base\PraticaFlowoperatore

  ocsdc.form.flow.listeelettoralioperatore:
    autowire: false
    autoconfigure: false
    class: App\Form\Operatore\ListeElettorali\ListeElettoraliOperatoreFlow
    parent: App\Form\Base\PraticaFlowoperatore

  ocsdc.form.flow.statofamigliaoperatore:
    autowire: false
    autoconfigure: false
    class: App\Form\Operatore\StatoFamiglia\StatoFamigliaOperatoreFlow
    parent: App\Form\Base\PraticaFlowoperatore

  # Flow service servizio
  ocsdc.form.flow.service:
    autowire: false
    autoconfigure: false
    class: App\Form\Admin\ServiceFlow
    parent: craue.form.flow
    arguments: [ "@logger","@translator" ]

  ocsdc.comunweb_content_provider:
    class: App\Services\ComunwebContentProviderService
    arguments: [ "@guzzle.client.comunweb","@logger" ]

  ocsdc.remote_content_provider: "@ocsdc.comunweb_content_provider"

  ocsdc.messages.client: "@guzzle.client.messages"
  ocsdc.messages_adapter:
    class: App\Services\MessagesAdapterService
    arguments: [ "@ocsdc.messages.client", "@logger", "@doctrine", "%messages_enabled%" ]

  ocsdc.twig.iter_calculator_extension:
    class: App\Twig\IterCalculatorExtension
    arguments: [ '%ocsdc_iter_duration_start_status%', '%ocsdc_iter_duration_end_statuses%' ]
    public: false
    tags:
      - { name: twig.extension }

  ocsdc.twig.json_decode:
    class: App\Twig\JsonDecode
    tags:
      - { name: twig.extension }

  ocsdc.twig.htmlspecialchars_decode:
    class: App\Twig\HtmlSpecialCharsDecode
    tags:
      - { name: twig.extension }

  ocsdc.twig.time_ago:
    class: App\Twig\TimeAgo
    tags:
      - { name: twig.extension }

  App\Services\PraticaStatusService:
    #arguments: [ "@doctrine.orm.entity_manager", "@logger", "@event_dispatcher" ]
    autowire: true

  ocsdc.pratica_status_service: '@App\Services\PraticaStatusService'

  ocsdc.protocollo_success_events_subscriber:
    class: App\EventListener\ProtocolloSuccessSubscriber
    arguments: [ "@ocsdc.pratica_status_service", "@logger" ]
    tags:
      - { name: kernel.event_subscriber }

  ocsdc.user_security_subscriber:
    class: App\EventListener\UserSecuritySubscriber
    arguments: [ "@fos_user.user_manager", "@router" ]
    tags:
      - { name: kernel.event_subscriber }

  ocsdc.cps.terms_acceptance_checker:
    class: App\Services\TermsAcceptanceCheckerService
    arguments: [ "@doctrine" ]

  #ocsdc.instance_service:
  #  class: App\Services\InstanceService
  #  arguments: [ "@doctrine", "%prefix%" ]

  ocsdc.instance_service: '@App\Services\InstanceService'

  ocsdc.version_service:
    class: App\Services\VersionService
    autowire: true

  ocsdc.form.flow.occupazionesuolopubblico:
    autowire: false
    autoconfigure: false
    class: App\Form\OccupazioneSuoloPubblico\OccupazioneSuoloPubblicoFlow
    parent: App\Form\Base\PraticaFlow
    tags:
      - { name: ocsdc.pratica.flow, alias: ocsdc.form.flow.occupazionesuolopubblico }

  ocsdc.form.flow.scia_pratica_edilizia:
    autowire: false
    autoconfigure: false
    class: App\Form\Scia\SciaPraticaEdiliziaFlow
    parent: App\Form\Base\PraticaFlow
    tags:
      - { name: ocsdc.pratica.flow, alias: ocsdc.form.flow.scia_pratica_edilizia }

  ocsdc.form.flow.contributoassociazioni:
    autowire: false
    autoconfigure: false
    class: App\Form\ContributoAssociazioni\ContributoAssociazioniFlow
    parent: App\Form\Base\PraticaFlow
    tags:
      - { name: ocsdc.pratica.flow, alias: ocsdc.form.flow.contributoassociazioni }

  App\Services\P7MSignatureCheckService:
    autowire: true

  ocsdc.p7m_signature_check: '@App\Services\P7MSignatureCheckService'

  ocsdc.p7m_thumbnailer_service:
    class: App\Services\P7MThumbnailerService
    arguments:
      - '@ocsdc.allegati.directory_namer'
      - '@vich_uploader.property_mapping_factory'
      - '@logger'
      - '%gsbinary%'

  ocsdc.validator.scia.at_least_one_attachment:
    class: App\Validator\Constraints\AtLeastOneAttachmentConstraintValidator
    arguments:
      - '@ocsdc.allegati.directory_namer'
      - '@vich_uploader.property_mapping_factory'
      - '@filesystem'
      - '@doctrine.orm.entity_manager'
    tags:
      - { name: 'validator.constraint_validator' }

  App\Validator\Constraints\AtLeastOneAttachmentConstraintValidator: '@ocsdc.validator.scia.at_least_one_attachment'

  ocsdc.giscom_api.adapter_direct:
    class: App\Services\GiscomAPIAdapterService
    arguments:
      - '@guzzle.client.giscom'
      - '@doctrine.orm.entity_manager'
      - '@logger'
      - '@ocsdc.giscom_api.mapper'
      - '@ocsdc.pratica_status_service'
      - "@ocsdc.status_mapper.giscom"

  ocsdc.giscom_api.adapter_delayed:
    class: App\Services\DelayedGiscomAPIAdapterService
    arguments:
      - '@ocsdc.giscom_api.adapter_direct'
      - '@doctrine.orm.entity_manager'
      - '@logger'
      - "@ocsdc.schedule_action_service"

  ocsdc.giscom_api.adapter: "@ocsdc.giscom_api.adapter_delayed"

  ocsdc.allegati.dematerialized_attacher:
    class: App\Services\DematerializedFormAllegatiAttacherService
    arguments:
      - '@doctrine.orm.entity_manager'

  ocsdc.protocollo_success_giscom_subscriber:
    class: App\EventListener\GiscomSendPraticaListener
    arguments: [ "@ocsdc.giscom_api.adapter", "@logger" ]
    tags:
      - { name: kernel.event_subscriber }

  ocsdc.schedule_action_service:
    class: App\Services\ScheduleActionService
    arguments: [ "@doctrine.orm.entity_manager","@logger" ]

  ocsdc.giscom_api.mapper:
    class: App\Services\GiscomAPIMapperService
    arguments:
      - '@doctrine.orm.entity_manager'
      - '@router'

  ocsdc.status_mapper.giscom:
    class: App\Mapper\Giscom\GiscomStatusMapper
    tags:
      - { name: 'ocsdc.status_mapper' }

  ocsdc.pratica_integration_service:
    class: App\Services\PraticaIntegrationService
    arguments:
      - '@doctrine.orm.entity_manager'
      - '@logger'
      - '@ocsdc.pratica_status_service'
      - "@ocsdc.modulo_pdf_builder"

  App\Services\FormServerApiAdapterService:
    arguments: [ "%formserver_private_url%", "@logger" ]

  ocsdc.formserver: '@App\Services\FormServerApiAdapterService'

  # Handlers servizi
  App\Handlers\Servizio\ServizioHandlerRegistry:
    autowire: true

  App\Handlers\Servizio\DefaultHandler:
    arguments:
      - "@security.token_storage"
      - "@logger"
      - "@router"
      - "@doctrine.orm.entity_manager"
      - "@ocsdc.form_flow_registry"
      - "@session"
      - "@templating"
      - "%formserver_public_url%"
    tags:
      - { name: ocsdc.servizio.handler, alias: default }

  ocsdc.handlers.servizio.imis:
    class: App\Handlers\Servizio\ImisHandler
    arguments: [ "@security.token_storage", "@logger", "@router" ]
    tags:
      - { name: ocsdc.servizio.handler, alias: ocsdc.servizio.handler }

  http.client:
    class: Symfony\Component\HttpClient\CurlHttpClient

  # FormIO validator
  formio.factory:
    class: App\FormIO\SchemaFactory
    arguments: [ '@ocsdc.formserver', '@http.client', '@session' ]

  formio.validator:
    class: App\FormIO\Validator
    arguments: [ '@form.factory', '@formio.factory' ]

  formio.expression_validator:
    class: App\FormIO\ExpressionValidator
    arguments: [ '@form.factory', '@formio.factory', '@doctrine.orm.entity_manager', '@logger' ]

  App\FormIO\SchemaFactoryInterface: '@formio.factory'

  App\FormIO\FormIOType:
    autowire: true
    tags:
      - { name: form.type }

  formio.constraint_validator:
    class: App\Validator\Constraints\ServerSideFormIOConstraintValidator
    public: true
    arguments: [ '@formio.validator' ]
    tags:
      - { name: validator.constraint_validator, alias: 'formio.constraint_validator' }

  formio.expression_based_validator:
    class: App\Validator\Constraints\ExpressionBasedFormIOConstraintValidator
    public: true
    arguments: [ '@formio.expression_validator' ]
    tags:
      - { name: validator.constraint_validator, alias: 'formio.expression_based_validator' }

  log_resolver.applicant_browser:
    class: App\Logging\ApplicantBrowserEventResolver

  ocsdc.logout_success_handler:
    class: App\Security\LogoutSuccessHandler
    arguments: [ '@router', "%single_logout_url%" ]
