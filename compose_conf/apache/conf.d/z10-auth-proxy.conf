<IfModule mod_shib>
    <IfModule mod_proxy.c>
        <IfModule mod_ssl.c>
            SSLProxyEngine On
            SSLProxyCheckPeerCN Off
            SSLProxyCheckPeerName Off
        </IfModule>

        ProxyPreserveHost Off
        ProxyRequests Off

        #<Location "/error">
        #    # See: https://wiki.shibboleth.net/confluence/display/SHIB2/NativeSPErrors
        #    ProxyPass "/error"
        #    ProxyPassReverse "/error"
        #</Location>


        <Location "/login">
            AuthType shibboleth
            ShibRequireSession On
            require valid-user
        </Location>

        # Commentare per togliere auth su CPS
        #<Location ~ "/(.*)/(pratiche|user|terms_accept)">
        #   AuthType shibboleth
        #   ShibRequireSession On
        #   require valid-user
        #</Location>

        # Attivazione CPS per singolo comune
        <Location ~ "^/comune-di-rovereto/(pratiche|user|terms_accept)">
           AuthType shibboleth
           ShibRequireSession On
           require valid-user
        </Location>

        #shibboleth unico
        ProxyPass "/Shibboleth.sso/" !
        # subfolder per Shibboleth: WIP
        ProxyPassMatch "/(.*)/Shibboleth.sso/" !
        <Location ~ "^/comune-di-opencontent/.*">
          ShibRequestSetting applicationId comune-di-opencontent
        </Location>

        <Location ~ "^/comune-di-rovereto/.*">
          ShibRequestSetting applicationId comune-di-rovereto
        </Location>

        <Location ~ "^/comune-di-vallelaghi/.*">
          ShibRequestSetting applicationId comune-di-vallelaghi
        </Location>

        <Location ~ "^/comune-di-tre-ville/.*">
          ShibRequestSetting applicationId comune-di-tre-ville
        </Location>

        <Location ~ "^/comune-di-cavedine/.*">
          ShibRequestSetting applicationId comune-di-cavedine
        </Location>

    </IfModule>
</IfModule>
