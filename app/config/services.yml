# Learn more about services, parameters and containers at
# http://symfony.com/doc/current/book/service_container.html
parameters:
#    parameter_name: value

services:
  League\Flysystem\FilesystemInterface: '@s3_filesystem'
  #League\Flysystem\FilesystemInterface: '@local_filesystem'

  ocsdc.s3_client:
    class: Aws\S3\S3Client
    arguments:
      - version: '2006-03-01' # or 'latest'
        region: '%s3_region%' # 'eu-central-1' for example
        credentials:
          key: '%s3_key%'
          secret: "%s3_secret%"

  Aws\S3\S3Client: '@ocsdc.s3_client'

  ocsdc.filesystem:
    class: AppBundle\Services\FileSystemService
    arguments: [ '@League\Flysystem\FilesystemInterface' ]
    public: true

  AppBundle\Services\FileSystemService: "@ocsdc.filesystem"

  AppBundle\Services\FileService:
    autowire: true
    arguments:
      $s3Bucket: '%s3_bucket%'
      $uploadDestination: '%upload_destination%'

  AppBundle\Services\MeetingService:
    autowire: true
    arguments:
      $defaultSender: "%default_from_email_address%"

  ocsdc.meeting_eventlistener:
    class: AppBundle\EventListener\MeetingLifeCycleListener
    tags:
      - { name: doctrine.event_listener, event: prePersist, connection: default }
      - { name: doctrine.event_listener, event: postPersist, connection: default }
      - { name: doctrine.event_listener, event: preUpdate, connection: default }
      - { name: doctrine.event_listener, event: postRemove, connection: default }
    autowire: true

  ocsdc.jwt_created_listener:
    class: AppBundle\EventListener\JWTCreatedListener
    arguments: [ '@request_stack' ]
    tags:
      - { name: kernel.event_listener, event: lexik_jwt_authentication.on_jwt_created, method: onJWTCreated }

  AppBundle\Controller\Rest\APIController:
    arguments: [ "@doctrine.orm.entity_manager", '@ocsdc.instance_service' ]

  AppBundle\Dto\ApplicationDto:
    autowire: true

  AppBundle\Controller\Rest\ServicesAPIController:
    autowire: true

  AppBundle\Controller\Rest\SessionAuthAPIController:
    autowire: true

  AppBundle\Controller\Rest\ServicesGroupAPIController:
    autowire: true

  AppBundle\Controller\Rest\ApplicationsAPIController:
    autowire: true

  AppBundle\Controller\Rest\CategoriesAPIController:
    autowire: true

  AppBundle\Controller\Rest\RecipientsAPIController:
    autowire: true

  AppBundle\Controller\Rest\GeographicAreasAPIController:
    autowire: true

  AppBundle\Controller\Rest\UsersAPIController:
    autowire: true

  AppBundle\Controller\Rest\SubscriptionsAPIController:
    autowire: true
    arguments:
      $defaultApiVersion: "%api_version%"

  AppBundle\Controller\Rest\SubscribersAPIController:
    autowire: true
    arguments:
      $defaultApiVersion: "%api_version%"

  AppBundle\Controller\Ui\Frontend\MessagesController:
    autowire: true

  AppBundle\Controller\Ui\Frontend\SearchController:
    autowire: true

  AppBundle\Controller\Ui\Frontend\UserController:
    autowire: true

  AppBundle\Controller\Rest\CalendarsAPIController:
    autowire: true

  AppBundle\Controller\Rest\MeetingsAPIController:
    autowire: true

  AppBundle\Controller\Rest\SubscriptionServicesAPIController:
    autowire: true
    arguments:
      $defaultApiVersion: "%api_version%"

  AppBundle\Controller\Rest\MessagesAPIController:
    autowire: true

  AppBundle\Controller\Rest\TenantAPIController:
    autowire: true

  AppBundle\Controller\Ui\Backend\AdminController:
    autowire: true
    arguments:
      $locales: "%app_locales%"
      $mailer: '@fos_user.mailer'

  AppBundle\Controller\Ui\Backend\ServiceController:
    autowire: true

  AppBundle\Controller\Ui\Backend\WebhookController:
    autowire: true

  AppBundle\Controller\Ui\Backend\PaymentGatewayController:
    autowire: true

  AppBundle\Controller\Ui\Backend\CategoryController:
    autowire: true

  AppBundle\Controller\Ui\Backend\RecipientController:
    autowire: true

  AppBundle\Controller\Ui\Backend\GeographicAreaController:
    autowire: true

  AppBundle\Controller\Ui\Backend\ServiceGroupController:
    autowire: true

  AppBundle\Controller\Ui\Frontend\PraticheController:
    autowire: true

  AppBundle\Controller\Ui\Backend\OperatoriController:
    autowire: true

  AppBundle\Controller\Ui\Frontend\DefaultController:
    autowire: true

  AppBundle\Controller\General\MetricsController:
    autowire: true

  AppBundle\Controller\Ui\Frontend\AllegatoController:
    autowire: true
    arguments:
      $allowedExtensions: '%allowed_extensions%'

  AppBundle\Controller\Ui\Frontend\ServiziController:
    autowire: true

  AppBundle\Controller\Ui\Frontend\PrintController:
    autowire: true

  AppBundle\Controller\Ui\Frontend\SubscriptionServicesController:
    autowire: true

  AppBundle\Controller\Rest\GiscomAPIController:
    autowire: true
    arguments:
      $giscomAPIAdapterService: '@ocsdc.giscom_api.adapter_direct'
      $delayedGiscomAPIAdapterService: '@ocsdc.giscom_api.adapter_delayed'

  AppBundle\Controller\Rest\FoldersAPIController:
    autowire: true

  AppBundle\Controller\Rest\DocumentsAPIController:
    arguments:
      [ "@translator", "%kernel.root_dir%", '@doctrine.orm.entity_manager', '@ocsdc.instance_service', '@logger' ]

  AppBundle\Controller\Ui\Frontend\PraticheAnonimeController:
    autowire: true
    arguments:
      $hashValidity: '%hash_validity%'

  AppBundle\Controller\Ui\Frontend\TrackingController:
    autowire: true

  AppBundle\Controller\General\SecurityController:
    autowire: true

  GuzzleHttp\Client: '@guzzle.client.mypay'

  i18n.datamapper:
    class: AppBundle\Form\I18n\I18nDataMapper
    autowire: true

  AppBundle\Form\Admin\RecipientType:
    arguments:
      - "@i18n.datamapper"
      - "%locale%"
      - "%app_locales%"
    tags:
      - { name: form.type }

  AppBundle\Form\Admin\GeographicAreaType:
    arguments:
      - "@i18n.datamapper"
      - "%locale%"
      - "%app_locales%"
    tags:
      - { name: form.type }

  AppBundle\Form\Admin\Servizio\GeneralDataType:
    arguments:
      - "@i18n.datamapper"
      - "%locale%"
      - "%app_locales%"
    tags:
      - { name: form.type }
    autowire: true

  AppBundle\Form\Admin\Servizio\CardDataType:
    arguments:
      - "@i18n.datamapper"
      - "%locale%"
      - "%app_locales%"
    tags:
      - { name: form.type }

  AppBundle\Form\Admin\CategoryType:
    autowire: true
    arguments:
      $locale: "%locale%"
      $locales: "%app_locales%"
    tags:
      - { name: form.type }

  AppBundle\Form\ApplicationMessageType:
    arguments: [ '@doctrine.orm.entity_manager' ]
    tags:
      - { name: form.type }

  AppBundle\Form\Scia\PraticaEdiliziaVincoliType:
    autowire: true
    tags:
      - { name: form.type }

  AppBundle\Form\Operatore\Base\ApplicationOutcomeType:
    autowire: true
    tags:
      - { name: form.type }

  AppBundle\Form\OccupazioneSuoloPubblico\ImportoType:
    autowire: true
    tags:
      - { name: form.type }

  AppBundle\Form\OccupazioneSuoloPubblico\ImportoChecker:
    autowire: true

  AppBundle\Form\CalendarBackofficeType:
    autowire: true
    tags:
      - { name: form.type }

  AppBundle\Form\CalendarType:
    autowire: true
    tags:
      - { name: form.type }

  AppBundle\Form\MeetingType:
    autowire: true
    tags:
      - { name: form.type }

  AppBundle\Form\OpeningHourType:
    autowire: true
    tags:
      - { name: form.type }

  AppBundle\Form\DocumentAPIType:
    arguments: [ "%kernel.root_dir%", '%allowed_extensions%' ]
    tags:
      - { name: form.type }

  AppBundle\Form\Rest\MessageFormType:
    arguments: [ "%kernel.root_dir%", '%allowed_extensions%' ]
    tags:
      - { name: form.type }

  AppBundle\Form\Rest\Transition\OutcomeFormType:
    arguments: [ "%kernel.root_dir%", '%allowed_extensions%' ]
    tags:
      - { name: form.type }

  AppBundle\Form\Rest\Transition\RequestIntegrationFormType:
    arguments: [ '%allowed_extensions%' ]
    tags:
      - { name: form.type }

  AppBundle\Form\Api\CategoryApiType:
    autowire: true
    tags:
      - { name: form.type }

  AppBundle\Services\Manager\PraticaManager:
    autowire: true

  AppBundle\Services\Manager\CategoryManager:
    autowire: true

  AppBundle\Services\Manager\ServiceManager:
    autowire: true

  AppBundle\Services\Manager\BackofficeManager:
    autowire: true

  AppBundle\Services\Manager\MessageManager:
    autowire: true
    arguments:
      $defaultSender: "%default_from_email_address%"

  AppBundle\Services\BreadcrumbsService:
    autowire: true

  AppBundle\Services\MyPayService:
    autowire: true

  AppBundle\Services\InstanceService:
    arguments: [ "@doctrine", "%instance%" ]

  AppBundle\Payment\Gateway\Bollo:
    autowire: true

  AppBundle\Payment\Gateway\MyPay:
    autowire: true

  AppBundle\Payment\Gateway\GenericExternalPay:
    autowire: true

  AppBundle\Validator\Constraints:
    autowire: true

  AppBundle\BackOffice\SubcriptionsBackOffice:
    arguments: [ "@logger","@translator","@doctrine.orm.entity_manager" ]
    public: true
    tags: [ 'app.backoffice' ]

  AppBundle\BackOffice\CalendarsBackOffice:
    autowire: true
    public: true
    tags: [ 'app.backoffice' ]

  AppBundle\BackOffice\SubcriptionPaymentsBackOffice:
    autowire: true
    public: true
    tags: [ 'app.backoffice' ]

  AppBundle\Services\BackOfficeCollection:
    arguments:
      - !tagged app.backoffice

  ocsdc.backoffices: '@AppBundle\Services\BackOfficeCollection'

  AppBundle\Controller\Ui\Frontend\DocumentController:
    autowire: true

  AppBundle\Controller\Ui\Frontend\SubscriptionsController:
    autowire: true

  AppBundle\Controller\Ui\Backend\SubscriberController:
    autowire: true,
    arguments:
      $defaultSender: "%default_from_email_address%"

  AppBundle\Controller\Ui\Backend\CalendarsController:
    autowire: true

  Vich\UploaderBundle\Naming\DirectoryNamerInterface: "@ocsdc.allegati.directory_namer"

  ocsdc.cps.userprovider:
    class: AppBundle\Services\CPSUserProvider
    arguments: [ "@doctrine.orm.default_entity_manager", "@logger" ]

  ocsdc.pat.authenticator:
    class: AppBundle\Security\PatAuthenticator
    arguments:
      - "@router"
      - "%shibbolet_server_varnames%"
      - "%login_route%"
      - '@AppBundle\Services\UserSessionService'
      - '@ocsdc.instance_service'
      - '@AppBundle\Services\Metrics\UserMetrics'
      - '@Lexik\Bundle\JWTAuthenticationBundle\Services\JWTTokenManagerInterface'

  ocsdc.openlogin.authenticator:
    class: AppBundle\Security\OpenLoginAuthenticator
    arguments:
      - "@router"
      - "%login_route%"
      - '@AppBundle\Services\UserSessionService'
      - '@ocsdc.instance_service'
      - '@AppBundle\Services\Metrics\UserMetrics'
      - '@Lexik\Bundle\JWTAuthenticationBundle\Services\JWTTokenManagerInterface'

  ocsdc.dedalogin.authenticator:
    class: AppBundle\Security\DedaLoginAuthenticator
    arguments:
      - "@router"
      - "%login_route%"
      - '@AppBundle\Services\UserSessionService'
      - '@ocsdc.instance_service'
      - '@AppBundle\Services\Metrics\UserMetrics'
      - '@Lexik\Bundle\JWTAuthenticationBundle\Services\JWTTokenManagerInterface'
      - "@session"

  ocsdc.cas.authenticator:
    class: AppBundle\Security\CasAuthenticator
    arguments:
      - "@router"
      - "%login_route%"
      - '@AppBundle\Services\UserSessionService'
      - '@ocsdc.instance_service'
      - '@AppBundle\Services\Metrics\UserMetrics'
      - '@Lexik\Bundle\JWTAuthenticationBundle\Services\JWTTokenManagerInterface'
      - "%cas_login_url%"
      - "%cas_validation_url%"
      - "@logger"

  AppBundle\Security\DedaLogin\DedaLoginClient:
    public: true
    arguments:
      - '@http.client'
      - "%deda_login_client_id%"
      - "%deda_login_secret%"
      - "%deda_login_env%"

  ocsdc.dedalogin.client: '@AppBundle\Security\DedaLogin\DedaLoginClient'

  ocsdc.cps.token_authenticator:
    class: AppBundle\Security\CPSAuthenticator
    arguments: [ "%shibbolet_server_varnames%",'@Symfony\Component\Security\Core\Security' ]

  ocsdc.cache_listener:
    class: AppBundle\EventListener\ResponseListener
    arguments: [ "%cache_max_age%" ]
    tags:
      - { name: kernel.event_listener, event: kernel.response, priority: -10000 }

  ocsdc.locale_rewrite_listener:
    class: AppBundle\EventListener\LocaleRewriteListener
    autowire: true
    arguments:
      $prefix: "%prefix%"
      $defaultLocale: "%locale%"
    tags:
      - { name: kernel.event_listener, event: kernel.request, priority: -200 }

  AppBundle\EventListener\LocaleRewriteListener: "@ocsdc.locale_rewrite_listener"

  ocsdc.locale_api_listener:
    class: AppBundle\EventListener\LocaleApiListener
    autowire: true
    arguments:
      $defaultLocale: "%locale%"
      $availableLocales: "%app_locales%"
    tags:
      - { name: kernel.event_listener, event: kernel.request, priority: -10 }
      - { name: kernel.event_listener, event: kernel.response, priority: -10 }

  AppBundle\EventListener\LocaleApiListener: "@ocsdc.locale_api_listener"

  ocsdc.cps.terms_acceptance_listener:
    class: AppBundle\EventListener\TermsAcceptListener
    arguments: [ "@router", "@security.token_storage", "@ocsdc.cps.terms_acceptance_checker" ]
    tags:
      - { name: kernel.event_listener, event: kernel.request, priority: -10 }

  ocsdc.cps.complete_profile_listener:
    class: AppBundle\EventListener\CompleteProfileListener
    arguments: [ "@router","@security.token_storage", "@ocsdc.cps.userprovider", "%PasswordLifeTime%" ]
    tags:
      - { name: kernel.event_listener, event: kernel.request, priority: -100 }

  ocsdc.redirect.after.login:
    class: AppBundle\Handlers\Auth\AfterLoginRedirection
    arguments: [ '@router','@security.authorization_checker' ]

  gedmo.listener.sluggable:
    class: Gedmo\Sluggable\SluggableListener
    tags:
      - { name: doctrine.event_subscriber, connection: default }
    calls:
      - [ setAnnotationReader, [ "@annotation_reader" ] ]

  monolog_processor:
    class: Monolog\Processor\PsrLogMessageProcessor
    tags:
      - { name: monolog.processor }

  ocsdc.form.flow.type_extension.help_data:
    class: AppBundle\Form\Extension\HelpDataTypeExtension
    arguments: [ "@translator", "%prefix%" ]
    tags:
      - { name: form.type_extension, alias: "form", extended_type: Symfony\Component\Form\Extension\Core\Type\FormType }

  ocsdc.allegati.directory_namer:
    class: AppBundle\Services\DirectoryNamerService

  ocsdc.allegati.mimetype_validator:
    class: AppBundle\Validator\Constraints\ValidMimeTypeValidator
    autowire: true
    arguments:
      $allowedExtensions: '%allowed_extensions%'
    tags:
      - { name: validator.constraint_validator }

  ocsdc.mailer:
    class: AppBundle\Services\MailerService
    autowire: true

  AppBundle\Services\MailerService: "@ocsdc.mailer"

  ocsdc.subscriptions_service:
    class: AppBundle\Services\SubscriptionsService
    arguments:
      - '@doctrine.orm.default_entity_manager'
      - '@ocsdc.instance_service'
      - '@ocsdc.mailer'
      - '@translator'
      - '@logger'
      - '@router'
      - '%ocsdc_scheme%'
      - '%ocsdc_host%'
      - '%default_from_email_address%'

  AppBundle\Services\SubscriptionsService: "@ocsdc.subscriptions_service"

  AppBundle\Services\ModuloPdfBuilderService:
    autowire: true
    arguments:
      $wkhtmltopdfService: "%wkhtmltopdf_service%"
      $dateTimeFormat: "%ocsdc_default_datetime_format%"
      $printablePassword: "%ez_password%"

  AppBundle\Services\WebhookService:
    autowire: true

  ocsdc.webhook_service: '@AppBundle\Services\WebhookService'

  AppBundle\Services\KafkaService:
    autowire: true
    arguments:
      $kafkaUrl: "%kafka_url%"
      $kafkaEventVersion: "%kafka_event_version%"
      $topics: "%kafka_topics%"

  ocsdc.kafka_service: '@AppBundle\Services\KafkaService'

  ocsdc.reminder_service:
    class: AppBundle\Services\ReminderService
    autowire: true

  AppBundle\Services\ReminderService: "@ocsdc.reminder_service"

  ocsdc.io_service:
    class: AppBundle\Services\IOService
    autowire: true
    arguments:
      - "%io_api_url%"

  AppBundle\Services\IOService: "@ocsdc.io_service"

  ocsdc.modulo_pdf_builder: '@AppBundle\Services\ModuloPdfBuilderService'

  ocsdc.protocollo.client: "@guzzle.client.protocollo_cct"

  ocsdc.protocollo.handler: "@ocsdc.protocollo.handlers.bypratica"

  AppBundle\Protocollo\ProtocolloHandlerRegistry:
    autowire: true

  ocsdc.protocollo.handlers.config:
    class: AppBundle\Protocollo\ConfigProtocolloHandler
    public: false
    arguments:
      - '@AppBundle\Protocollo\ProtocolloHandlerRegistry'
      - '%protocollo%'

  ocsdc.protocollo.handlers.bypratica:
    class: AppBundle\Protocollo\ByPraticaProtocolloHandler
    public: false
    arguments:
      - '@AppBundle\Protocollo\ProtocolloHandlerRegistry'

  ocsdc.protocollo.handlers.dummy:
    class: AppBundle\Protocollo\DummyProtocolloHandler
    public: false
    tags:
      - { name: ocsdc.protocollo.handler, alias: dummy }

  ocsdc.protocollo.handlers.external:
    class: AppBundle\Protocollo\ExternalProtocolloHandler
    public: false
    tags:
      - { name: ocsdc.protocollo.handler, alias: external }

  ocsdc.protocollo.handlers.pec:
    class: AppBundle\Protocollo\PecProtocolloHandler
    public: false
    autowire: true
    arguments:
      $host: "%pec_mailer_host%"
      $port: "%pec_mailer_port%"
      $user:  "%pec_mailer_user%"
      $password: "%pec_mailer_password%"
      $sender: "%pec_delivery_address%"
    tags:
      - { name: ocsdc.protocollo.handler, alias: pec }


  ocsdc.protocollo.handlers.pitre:
    class: AppBundle\Protocollo\PiTreProtocolloHandler
    arguments:
      $client: "@ocsdc.protocollo.client"
      $instance: "%prefix%"
    autowire: true
    public: false
    tags:
      - { name: ocsdc.protocollo.handler, alias: pitre }

  ocsdc.protocollo.handlers.infor:
    class: AppBundle\Protocollo\InforProtocolloHandler
    autowire: true
    public: false
    tags:
      - { name: ocsdc.protocollo.handler, alias: infor }

  ocsdc.protocollo.handlers.sipal:
    class: AppBundle\Protocollo\SipalProtocolloHandler
    autowire: true
    public: false
    tags:
      - { name: ocsdc.protocollo.handler, alias: sipal }

  AppBundle\Services\DelayedProtocolloService:
    arguments: [ "@ocsdc.protocollo_direct","@doctrine.orm.entity_manager","@logger", "@ocsdc.schedule_action_service" ]

  AppBundle\Services\ProtocolloService:
    arguments: [ "@ocsdc.protocollo.handler","@doctrine.orm.entity_manager","@logger","@event_dispatcher" ]

  ocsdc.protocollo: '@AppBundle\Services\DelayedProtocolloService'
  ocsdc.protocollo_direct: '@AppBundle\Services\ProtocolloService'

  ocsdc.listeners.kafka:
    class: AppBundle\EventListener\KafkaListener
    autowire: true
    tags:
      - { name: kernel.event_listener, event: ocsdc.kafka, method: produce, priority: 10 }

  ocsdc.pratica_listeners.createpdf:
    class: AppBundle\EventListener\CreatePdfPraticaListener
    arguments: [ "@ocsdc.modulo_pdf_builder", "@logger" ]
    tags:
      - { name: kernel.event_listener, event: ocsdc.pratica.on_status_change, method: onStatusChange, priority: 10 }

  ocsdc.pratica_listeners.sendmail:
    class: AppBundle\EventListener\SendMailPraticaListener
    arguments: [ "@ocsdc.mailer", "%default_from_email_address%", "@logger" ]
    tags:
      - { name: kernel.event_listener, event: ocsdc.pratica.on_status_change, method: onStatusChange, priority: 20 }

  ocsdc.pratica_listeners.statusmessage:
    class: AppBundle\EventListener\StatusMessagePraticaListener
    autowire: true
    tags:
      - { name: kernel.event_listener, event: ocsdc.pratica.on_status_change, method: onStatusChange, priority: 21 }

  ocsdc.pratica_listeners.backoffice:
    class: AppBundle\EventListener\BackOfficePraticaListener
    autowire: true
    tags:
      - { name: kernel.event_listener, event: ocsdc.pratica.on_status_change, method: onStatusChange, priority: 30 }

  ocsdc.pratica_listeners.protocollo:
    class: AppBundle\EventListener\ProtocollaPraticaListener
    arguments: [ "@ocsdc.protocollo", "@ocsdc.pratica_status_service","@logger" ]
    tags:
      - { name: kernel.event_listener, event: ocsdc.pratica.on_status_change, method: onStatusChange, priority: 100 }

  ocsdc.pratica_listeners.webhook:
    class: AppBundle\EventListener\WebhookApplicationListener
    autowire: true
    tags:
      - { name: kernel.event_listener, event: ocsdc.pratica.on_status_change, method: onStatusChange, priority: 110 }
      - { name: kernel.event_listener, event: ocsdc.message.created, method: onMessageCreated, priority: 110 }

  ocsdc.pratica_listeners.payment_reminder:
    class: AppBundle\EventListener\PaymentReminderListener
    autowire: true
    tags:
      - { name: kernel.event_listener, event: ocsdc.pratica.on_status_change, method: onStatusChange, priority: 120 }

  AppBundle\EventListener\PaymentReminderListener: "@ocsdc.pratica_listeners.payment_reminder"

  ocsdc.form.flow.storage_key_generator:
    class: AppBundle\Form\UserSessionStorageKeyGenerator

  ocsdc.form.type.choose_allegato:
    class: AppBundle\Form\Base\ChooseAllegatoType
    arguments: [ "@doctrine.orm.entity_manager", "@validator" ]
    tags:
      - { name: form.type }

  ocsdc.form.type.upload_allegato:
    class: AppBundle\Form\Base\UploadAllegatoType
    arguments: [ "@doctrine.orm.entity_manager", "@validator" ]
    tags:
      - { name: form.type }

  ocsdc.form.type.signed_allegato:
    class: AppBundle\Form\Operatore\Base\SignedAllegatoType
    arguments: [ "@doctrine.orm.entity_manager", "@validator", "@ocsdc.p7m_signature_check" ]
    tags:
      - { name: form.type }

  ocsdc.form.type.scia_edilizia_modulo_scia_pratica_edilizia_type:
    class: AppBundle\Form\Scia\PraticaEdiliziaModuloSciaType
    arguments: [ "@doctrine.orm.entity_manager", "@validator", "@ocsdc.p7m_signature_check" ]
    tags:
      - { name: form.type }

  ocsdc.form.type.scia_edilizia_allegati_modulo_scia_pratica_edilizia_type:
    class: AppBundle\Form\Scia\PraticaEdiliziaAllegatiModuloSciaType
    arguments: [ "@doctrine.orm.entity_manager", "@validator", "@ocsdc.p7m_signature_check" ]
    tags:
      - { name: form.type }

  ocsdc.form.type.scia_ediliza_soggetti_type:
    class: AppBundle\Form\Scia\PraticaEdiliziaSoggettiType
    arguments: [ "@doctrine.orm.entity_manager", "@validator", "@ocsdc.p7m_signature_check" ]
    tags:
      - { name: form.type }

  ocsdc.form.type.scia_edilizia_allegati_tecnici_type:
    class: AppBundle\Form\Scia\PraticaEdiliziaAllegatiTecniciType
    arguments: [ "@doctrine.orm.entity_manager", "@validator", "@ocsdc.p7m_signature_check" ]
    tags:
      - { name: form.type }

  ocsdc.form.type.scia_edilizia_ulteriori_allegati_tecnici_type:
    class: AppBundle\Form\Scia\PraticaEdiliziaUlterioriAllegatiTecniciType
    arguments: [ "@doctrine.orm.entity_manager", "@validator", "@ocsdc.p7m_signature_check" ]
    tags:
      - { name: form.type }

  ocsdc.form.type.scia_edilizia_provvedimenti_type:
    class: AppBundle\Form\Scia\PraticaEdiliziaProvvedimentiType
    arguments: [ "@doctrine.orm.entity_manager", "@validator", "@ocsdc.p7m_signature_check" ]
    tags:
      - { name: form.type }

  ocsdc.form.type.summary_type:
    class: AppBundle\Form\Base\SummaryType
    autowire: true
    tags:
      - { name: form.type }

  ocsdc.form.type.select_payment_gateway_type:
    class: AppBundle\Form\Base\SelectPaymentGatewayType
    autowire: true
    tags:
      - { name: form.type }

  AppBundle\Form\FormIO\FormIORenderType:
    autowire: true
    tags:
      - { name: form.type }

  AppBundle\Form\Admin\Servizio\FormIOBuilderRenderType:
    autowire: true
    tags:
      - { name: form.type }

  AppBundle\Form\Admin\Servizio\FormIOI18nType:
    autowire: true
    arguments:
      $locale: "%locale%"
      $locales: "%app_locales%"
    tags:
      - { name: form.type }

  AppBundle\Form\Admin\Ente\WebhookType:
    autowire: true
    tags:
      - { name: form.type }

  AppBundle\Form\Admin\Servizio\FormIOTemplateType:
    autowire: true
    tags:
      - { name: form.type }

  AppBundle\Form\Base\PaymentGatewayType:
    autowire: true
    tags:
      - { name: form.type }

  AppBundle\Form\Admin\Servizio\PaymentDataType:
    autowire: true
    tags:
      - { name: form.type }

  AppBundle\Form\Admin\Servizio\FeedbackMessagesDataType:
    autowire: true
    arguments:
      $locales: "%app_locales%"
    tags:
      - { name: form.type }

  AppBundle\Form\Admin\Servizio\IntegrationsDataType:
    autowire: true
    arguments: [ "@translator" ]
    tags:
      - { name: form.type }

  AppBundle\Form\IntegrationsType:
    autowire: true
    tags:
      - { name: form.type }

  AppBundle\Form\Admin\Servizio\ProtocolDataType:
    autowire: true
    tags:
      - { name: form.type }

  AppBundle\Form\Admin\Ente\EnteType:
    autowire: true
    tags:
      - { name: form.type }

  AppBundle\Form\TenantType:
    autowire: true
    tags:
      - { name: form.type }

  AppBundle\Form\SubscriptionServiceType:
    autowire: true
    tags:
      - { name: form.type }

  AppBundle\Form\SubscriptionType:
    autowire: true
    tags:
      - { name: form.type }

  AppBundle\Form\OperatoreUserType:
    autowire: true
    tags:
      - { name: form.type }

  AppBundle\Form\SubscriptionPaymentType:
    autowire: true
    tags:
      - { name: form.type }

  ocsdc.form.type.payment_gateway_type: '@AppBundle\Form\Base\PaymentGatewayType'

  ocsdc.form_flow_registry: '@AppBundle\Form\PraticaFlowRegistry'

  AppBundle\Form\PraticaFlowRegistry:
    autowire: true

  ocsdc.form.flow.pratica:
    class: AppBundle\Form\Base\PraticaFlow
    parent: craue.form.flow
    arguments:
      - "@logger"
      - "@translator"
      - "@ocsdc.pratica_status_service"
      - "@ocsdc.modulo_pdf_builder"
      - "@ocsdc.allegati.dematerialized_attacher"
      - "%prefix%"
      - "@formio.factory"
      - "@doctrine.orm.entity_manager"
      - '@AppBundle\Services\UserSessionService'
      - "%locale%"

  ocsdc.form.flow.asilonido:
    class: AppBundle\Form\IscrizioneAsiloNido\IscrizioneAsiloNidoFlow
    parent: ocsdc.form.flow.pratica
    tags:
      - { name: ocsdc.pratica.flow, alias: ocsdc.form.flow.asilonido }

  ocsdc.form.flow.autoletturaacqua:
    class: AppBundle\Form\AutoletturaAcqua\AutoletturaAcquaFlow
    parent: ocsdc.form.flow.pratica
    tags:
      - { name: ocsdc.pratica.flow, alias: ocsdc.form.flow.autoletturaacqua }

  ocsdc.form.flow.iscrizioneregistroassociazioni:
    class: AppBundle\Form\IscrizioneRegistroAssociazioni\IscrizioneRegistroAssociazioniFlow
    parent: ocsdc.form.flow.pratica
    tags:
      - { name: ocsdc.pratica.flow, alias: ocsdc.form.flow.iscrizioneregistroassociazioni }

  ocsdc.form.flow.contributopannolini:
    class: AppBundle\Form\ContributoPannolini\ContributoPannoliniFlow
    parent: ocsdc.form.flow.pratica
    tags:
      - { name: ocsdc.pratica.flow, alias: ocsdc.form.flow.contributopannolini }

  ocsdc.form.flow.cambioresidenza:
    class: AppBundle\Form\CambioResidenza\CambioResidenzaFlow
    parent: ocsdc.form.flow.pratica
    tags:
      - { name: ocsdc.pratica.flow, alias: ocsdc.form.flow.cambioresidenza }

  ocsdc.form.flow.allacciamentoacquedotto:
    class: AppBundle\Form\AllacciamentoAcquedotto\AllacciamentoAcquedottoFlow
    parent: ocsdc.form.flow.pratica
    arguments: [ "@logger","@translator" ]
    tags:
      - { name: ocsdc.pratica.flow, alias: ocsdc.form.flow.allacciamentoacquedotto }

  ocsdc.form.flow.certificatonascita:
    class: AppBundle\Form\CertificatoNascita\CertificatoNascitaFlow
    parent: ocsdc.form.flow.pratica
    tags:
      - { name: ocsdc.pratica.flow, alias: ocsdc.form.flow.certificatonascita }

  ocsdc.form.flow.estrattonascita:
    class: AppBundle\Form\EstrattoNascita\EstrattoNascitaFlow
    parent: ocsdc.form.flow.pratica
    tags:
      - { name: ocsdc.pratica.flow, alias: ocsdc.form.flow.estrattonascita }

  ocsdc.form.flow.attonascita:
    class: AppBundle\Form\AttoNascita\AttoNascitaFlow
    parent: ocsdc.form.flow.pratica
    tags:
      - { name: ocsdc.pratica.flow, alias: ocsdc.form.flow.attonascita }

  ocsdc.form.flow.certificatomorte:
    class: AppBundle\Form\CertificatoMorte\CertificatoMorteFlow
    parent: ocsdc.form.flow.pratica
    tags:
      - { name: ocsdc.pratica.flow, alias: ocsdc.form.flow.certificatomorte }

  ocsdc.form.flow.estrattomorte:
    class: AppBundle\Form\EstrattoMorte\EstrattoMorteFlow
    parent: ocsdc.form.flow.pratica
    tags:
      - { name: ocsdc.pratica.flow, alias: ocsdc.form.flow.estrattomorte }

  ocsdc.form.flow.attomorte:
    class: AppBundle\Form\AttoMorte\AttoMorteFlow
    parent: ocsdc.form.flow.pratica
    tags:
      - { name: ocsdc.pratica.flow, alias: ocsdc.form.flow.attomorte }

  ocsdc.form.flow.certificatomatrimonio:
    class: AppBundle\Form\CertificatoMatrimonio\CertificatoMatrimonioFlow
    parent: ocsdc.form.flow.pratica
    tags:
      - { name: ocsdc.pratica.flow, alias: ocsdc.form.flow.certificatomatrimonio }

  ocsdc.form.flow.estrattomatrimonio:
    class: AppBundle\Form\EstrattoMatrimonio\EstrattoMatrimonioFlow
    parent: ocsdc.form.flow.pratica
    tags:
      - { name: ocsdc.pratica.flow, alias: ocsdc.form.flow.estrattomatrimonio }

  ocsdc.form.flow.attomatrimonio:
    class: AppBundle\Form\AttoMatrimonio\AttoMatrimonioFlow
    parent: ocsdc.form.flow.pratica
    tags:
      - { name: ocsdc.pratica.flow, alias: ocsdc.form.flow.attomatrimonio }

  #  ocsdc.form.flow.nullaostamatrimonio:
  #    class: AppBundle\Form\CertificatoAnagrafico\CertificatoAnagraficoFlow
  #    parent: ocsdc.form.flow.pratica

  ocsdc.form.flow.attestazioneanagrafica:
    class: AppBundle\Form\AttestazioneAnagrafica\AttestazioneAnagraficaFlow
    parent: ocsdc.form.flow.pratica
    tags:
      - { name: ocsdc.pratica.flow, alias: ocsdc.form.flow.attestazioneanagrafica }

  ocsdc.form.flow.listeelettorali:
    class: AppBundle\Form\ListeElettorali\ListeElettoraliFlow
    parent: ocsdc.form.flow.pratica
    tags:
      - { name: ocsdc.pratica.flow, alias: ocsdc.form.flow.listeelettorali }

  ocsdc.form.flow.statofamiglia:
    class: AppBundle\Form\StatoFamiglia\StatoFamigliaFlow
    parent: ocsdc.form.flow.pratica
    tags:
      - { name: ocsdc.pratica.flow, alias: ocsdc.form.flow.statofamiglia }

  ocsdc.form.flow.formio:
    class: AppBundle\Form\FormIO\FormIOFlow
    parent: ocsdc.form.flow.pratica
    tags:
      - { name: ocsdc.pratica.flow, alias: ocsdc.form.flow.formio }

  # Inzio operatore

  ocsdc.form.flow.praticaoperatore:
    class: AppBundle\Form\Operatore\Base\PraticaOperatoreFlow
    parent: craue.form.flow
    arguments: [ "@logger","@translator" ]

  ocsdc.form.flow.standardoperatore:
    class: AppBundle\Form\Operatore\Standard\StandardOperatoreFlow
    parent: ocsdc.form.flow.praticaoperatore

  ocsdc.form.flow.operatore.standardallegatonofirma:
    class: AppBundle\Form\Operatore\Standard\StandardAllegatoNoFirmaFlow
    parent: ocsdc.form.flow.praticaoperatore

  ocsdc.form.flow.certificatonascitaoperatore:
    class: AppBundle\Form\Operatore\CertificatoNascita\CertificatoNascitaOperatoreFlow
    parent: ocsdc.form.flow.praticaoperatore

  ocsdc.form.flow.attestazioneanagraficaoperatore:
    class: AppBundle\Form\Operatore\AttestazioneAnagrafica\AttestazioneAnagraficaOperatoreFlow
    parent: ocsdc.form.flow.praticaoperatore

  ocsdc.form.flow.listeelettoralioperatore:
    class: AppBundle\Form\Operatore\ListeElettorali\ListeElettoraliOperatoreFlow
    parent: ocsdc.form.flow.praticaoperatore

  ocsdc.form.flow.statofamigliaoperatore:
    class: AppBundle\Form\Operatore\StatoFamiglia\StatoFamigliaOperatoreFlow
    parent: ocsdc.form.flow.praticaoperatore

  # Flow service servizio
  AppBundle\Form\Admin\ServiceFlow:
    parent: craue.form.flow
    arguments: [ "@logger","@translator" ]

  AppBundle\Form\ServizioFormType:
    autowire: true
    tags:
      - { name: form.type }

  ocsdc.comunweb_content_provider:
    class: AppBundle\Services\ComunwebContentProviderService
    arguments: [ "@guzzle.client.comunweb","@logger" ]

  ocsdc.remote_content_provider: "@ocsdc.comunweb_content_provider"

  AppBundle\Services\RemoteContentProviderServiceInterface: "@ocsdc.comunweb_content_provider"

  ocsdc.messages.client: "@guzzle.client.messages"
  ocsdc.messages_adapter:
    class: AppBundle\Services\MessagesAdapterService
    arguments: [ "@ocsdc.messages.client", "@logger", "@doctrine", "%messages_enabled%" ]

  AppBundle\Services\MessagesAdapterService: "@ocsdc.messages_adapter"

  AppBundle\Twig\AppExtension:
    autowire: true
    tags:
      - { name: twig.extension }

  ocsdc.twig.iter_calculator_extension:
    class: AppBundle\Twig\IterCalculatorExtension
    arguments: [ '%ocsdc_iter_duration_start_status%', '%ocsdc_iter_duration_end_statuses%' ]
    public: false
    tags:
      - { name: twig.extension }

  ocsdc.twig.json_decode:
    class: AppBundle\Twig\JsonDecode
    tags:
      - { name: twig.extension }

  ocsdc.twig.unserialize:
    class: AppBundle\Twig\Unserialize
    tags:
      - { name: twig.extension }

  ocsdc.twig.htmlspecialchars_decode:
    class: AppBundle\Twig\HtmlSpecialCharsDecode
    tags:
      - { name: twig.extension }

  ocsdc.twig.time_ago:
    class: AppBundle\Twig\TimeAgo
    tags:
      - { name: twig.extension }

  AppBundle\Services\PraticaStatusService:
    #arguments: [ "@doctrine.orm.entity_manager", "@logger", "@event_dispatcher" ]
    autowire: true

  ocsdc.pratica_status_service: '@AppBundle\Services\PraticaStatusService'

  ocsdc.protocollo_success_events_subscriber:
    class: AppBundle\EventListener\ProtocolloSuccessSubscriber
    arguments: [ "@ocsdc.pratica_status_service", "@logger" ]
    tags:
      - { name: kernel.event_subscriber }

  ocsdc.user_security_subscriber:
    class: AppBundle\EventListener\UserSecuritySubscriber
    autowire: true
    tags:
      - { name: kernel.event_subscriber }

  ocsdc.cps.terms_acceptance_checker:
    class: AppBundle\Services\TermsAcceptanceCheckerService
    arguments: [ "@doctrine" ]

  #ocsdc.instance_service:
  #  class: AppBundle\Services\InstanceService
  #  arguments: [ "@doctrine", "%prefix%" ]

  ocsdc.instance_service: '@AppBundle\Services\InstanceService'

  ocsdc.version_service:
    class: AppBundle\Services\VersionService
    autowire: true

  AppBundle\Services\VersionService: "@ocsdc.version_service"

  ocsdc.form.flow.occupazionesuolopubblico:
    class: AppBundle\Form\OccupazioneSuoloPubblico\OccupazioneSuoloPubblicoFlow
    parent: ocsdc.form.flow.pratica
    tags:
      - { name: ocsdc.pratica.flow, alias: ocsdc.form.flow.occupazionesuolopubblico }

  ocsdc.form.flow.scia_pratica_edilizia:
    class: AppBundle\Form\Scia\SciaPraticaEdiliziaFlow
    parent: ocsdc.form.flow.pratica
    tags:
      - { name: ocsdc.pratica.flow, alias: ocsdc.form.flow.scia_pratica_edilizia }

  ocsdc.form.flow.contributoassociazioni:
    class: AppBundle\Form\ContributoAssociazioni\ContributoAssociazioniFlow
    parent: ocsdc.form.flow.pratica
    tags:
      - { name: ocsdc.pratica.flow, alias: ocsdc.form.flow.contributoassociazioni }

  AppBundle\Services\P7MSignatureCheckService:
    autowire: true

  ocsdc.p7m_signature_check: '@AppBundle\Services\P7MSignatureCheckService'

  ocsdc.p7m_thumbnailer_service:
    class: AppBundle\Services\P7MThumbnailerService
    arguments:
      - '@ocsdc.allegati.directory_namer'
      - '@vich_uploader.property_mapping_factory'
      - '@logger'
      - '%gsbinary%'

  ocsdc.validator.scia.at_least_one_attachment:
    class: AppBundle\Validator\Constraints\AtLeastOneAttachmentConstraintValidator
    arguments:
      - '@ocsdc.allegati.directory_namer'
      - '@vich_uploader.property_mapping_factory'
      - '@ocsdc.filesystem'
      - '@doctrine.orm.entity_manager'
    tags:
      - { name: 'validator.constraint_validator' }

  AppBundle\Validator\Constraints\AtLeastOneAttachmentConstraintValidator: '@ocsdc.validator.scia.at_least_one_attachment'

  ocsdc.giscom_api.adapter_direct:
    class: AppBundle\Services\GiscomAPIAdapterService
    arguments:
      - '@guzzle.client.giscom'
      - '@doctrine.orm.entity_manager'
      - '@logger'
      - '@ocsdc.giscom_api.mapper'
      - '@ocsdc.pratica_status_service'
      - "@ocsdc.status_mapper.giscom"

  ocsdc.giscom_api.adapter_delayed:
    class: AppBundle\Services\DelayedGiscomAPIAdapterService
    arguments:
      - '@ocsdc.giscom_api.adapter_direct'
      - '@doctrine.orm.entity_manager'
      - '@logger'
      - "@ocsdc.schedule_action_service"

  ocsdc.giscom_api.adapter: "@ocsdc.giscom_api.adapter_delayed"

  ocsdc.allegati.dematerialized_attacher:
    class: AppBundle\Services\DematerializedFormAllegatiAttacherService
    autowire: true
    arguments:
      - '@doctrine.orm.entity_manager'

  AppBundle\Services\DematerializedFormAllegatiAttacherService: "@ocsdc.allegati.dematerialized_attacher"

  ocsdc.protocollo_success_giscom_subscriber:
    class: AppBundle\EventListener\GiscomSendPraticaListener
    arguments: [ "@ocsdc.giscom_api.adapter", "@logger" ]
    tags:
      - { name: kernel.event_subscriber }

  ocsdc.schedule_action_service:
    class: AppBundle\Services\ScheduleActionService
    arguments: [ "@doctrine.orm.entity_manager","@logger" ]

  AppBundle\Services\ScheduleActionService: "@ocsdc.schedule_action_service"

  ocsdc.giscom_api.mapper:
    class: AppBundle\Services\GiscomAPIMapperService
    arguments:
      - '@doctrine.orm.entity_manager'
      - '@router'

  AppBundle\Services\GiscomAPIMapperService: "@ocsdc.giscom_api.mapper"

  ocsdc.status_mapper.giscom:
    class: AppBundle\Mapper\Giscom\GiscomStatusMapper
    tags:
      - { name: 'ocsdc.status_mapper' }

  AppBundle\Mapper\Giscom\GiscomStatusMapper: "@ocsdc.status_mapper.giscom"

  ocsdc.pratica_integration_service:
    class: AppBundle\Services\PraticaIntegrationService
    arguments:
      - '@doctrine.orm.entity_manager'
      - '@logger'
      - '@ocsdc.pratica_status_service'
      - "@ocsdc.modulo_pdf_builder"

  AppBundle\Services\PraticaIntegrationService: "@ocsdc.pratica_integration_service"

  AppBundle\Services\FormServerApiAdapterService:
    arguments: [ "%formserver_private_url%", "%formserver_public_url%", "@logger" ]

  ocsdc.formserver: '@AppBundle\Services\FormServerApiAdapterService'

  # Handlers servizi
  AppBundle\Handlers\Servizio\ServizioHandlerRegistry:
    autowire: true

  AppBundle\Handlers\Servizio\DefaultHandler:
    arguments:
      - "@security.token_storage"
      - "@logger"
      - "@router"
      - "@doctrine.orm.entity_manager"
      - "@ocsdc.form_flow_registry"
      - "@session"
      - "@templating"
      - "%formserver_public_url%"
      - '@AppBundle\Services\UserSessionService'
      - "%browsers_restrictions%"
    tags:
      - { name: ocsdc.servizio.handler, alias: default }

  ocsdc.handlers.servizio.imis:
    class: AppBundle\Handlers\Servizio\ImisHandler
    arguments: [ "@security.token_storage", "@logger", "@router" ]
    tags:
      - { name: ocsdc.servizio.handler, alias: ocsdc.servizio.handler }

  http.client:
    class: Symfony\Component\HttpClient\CurlHttpClient

  # FormIO validator
  formio.factory:
    class: AppBundle\FormIO\SchemaFactory
    arguments: [ '@ocsdc.formserver', '@http.client', '@session' ]

  formio.validator:
    class: AppBundle\FormIO\Validator
    arguments: [ '@form.factory', '@formio.factory' ]

  formio.expression_validator:
    class: AppBundle\FormIO\ExpressionValidator
    arguments: [ '@form.factory', '@formio.factory', '@doctrine.orm.entity_manager', '@logger' ]

  AppBundle\FormIO\ExpressionValidator: "@formio.expression_validator"

  AppBundle\FormIO\SchemaFactoryInterface: '@formio.factory'

  AppBundle\FormIO\FormIOType:
    autowire: true
    tags:
      - { name: form.type }

  formio.constraint_validator:
    class: AppBundle\Validator\Constraints\ServerSideFormIOConstraintValidator
    public: true
    arguments: [ '@formio.validator' ]
    tags:
      - { name: validator.constraint_validator, alias: 'formio.constraint_validator' }

  formio.expression_based_validator:
    class: AppBundle\Validator\Constraints\ExpressionBasedFormIOConstraintValidator
    public: true
    arguments: [ '@formio.expression_validator' ]
    tags:
      - { name: validator.constraint_validator, alias: 'formio.expression_based_validator' }

  log_resolver.applicant_browser:
    class: AppBundle\Logging\ApplicantBrowserEventResolver

  ocsdc.logout_success_handler:
    class: AppBundle\Security\LogoutSuccessHandler
    arguments: [ '@router', "%single_logout_url%" ]

  AppBundle\Services\UserSessionService:
    autowire: true

  AppBundle\Services\Metrics\ApplicationMetrics:
    autowire: true
    tags:
      - { name: prometheus_metrics_bundle.metrics_generator }

  AppBundle\Services\Metrics\ScheduledActionMetrics:
    autowire: true
    tags:
      - { name: prometheus_metrics_bundle.metrics_generator }

  AppBundle\Services\Metrics\UserMetrics:
    autowire: true
    tags:
      - { name: prometheus_metrics_bundle.metrics_generator }

  AppBundle\Services\PraticaPlaceholderService:
    autowire: true

  security.access.users_voter:
    class: AppBundle\Security\Voters\UserVoter
    autowire: true
    tags:
      - { name: security.voter }

  security.access.backoffices_voter:
    class: AppBundle\Security\Voters\BackofficeVoter
    autowire: true
    tags:
      - { name: security.voter }

  security.access.subscription_voter:
    class: AppBundle\Security\Voters\SubscriptionVoter
    autowire: true
    tags:
      - { name: security.voter }

  security.access.subscriber_voter:
    class: AppBundle\Security\Voters\SubscriberVoter
    autowire: true
    tags:
      - { name: security.voter }

  security.access.message_voter:
    class: AppBundle\Security\Voters\MessageVoter
    autowire: true
    tags:
      - { name: security.voter }

  security.access.application_voter:
    class: AppBundle\Security\Voters\ApplicationVoter
    autowire: true
    tags:
      - { name: security.voter }

  security.access.folder_voter:
    class: AppBundle\Security\Voters\FolderVoter
    autowire: true
    tags:
      - { name: security.voter }

  security.access.document_voter:
    class: AppBundle\Security\Voters\DocumentVoter
    autowire: true
    tags:
      - { name: security.voter }

  security.access.calendar_voter:
    class: AppBundle\Security\Voters\CalendarVoter
    autowire: true
    tags:
      - { name: security.voter }

  security.access.meeting_voter:
    class: AppBundle\Security\Voters\MeetingVoter
    autowire: true
    tags:
      - { name: security.voter }

  security.access.attachment_voter:
    class: AppBundle\Security\Voters\AttachmentVoter
    autowire: true
    arguments:
      $hashValidity: '%hash_validity%'
    tags:
      - { name: security.voter }
