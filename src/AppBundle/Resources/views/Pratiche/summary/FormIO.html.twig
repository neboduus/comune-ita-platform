<div id="pratica-summary">

  {{ include('AppBundle:Pratiche/summary/parts:allegati_operatore.html.twig', {'pratica':pratica, 'user': user}) }}

  {% if pratica.statusName == 'STATUS_PAYMENT_PENDING' %}
    <div class='text-center mt-5'><a href="{{ pratica.paymentData.response.url }}" class='btn btn-lg btn-primary'>Procedi
        con il pagamento sul sito di MyPay</a></div>
    <p class='mt-5'>
      Cliccando sul bottone qui sopra sarai reindirizzato verso l'infrastruttura di MyPay.<br/>
      A pagamento completato sarai riportato a questa pagina, la verifica dell'esito avviene in automatico.
    </p>
  {% elseif pratica.statusName == 'STATUS_PAYMENT_OUTCOME_PENDING' %}
    <div class="alert alert-info">Siamo in attesa dell'esito del pagamento</div>
  {% elseif pratica.status >= constant('STATUS_SUBMITTED', pratica) %}
    {{ include('AppBundle:Pratiche/summary/parts:protocollo.html.twig', {'pratica':pratica, 'user': user}) }}
  {% endif %}

  {% if pratica.status >= constant('STATUS_SUBMITTED', pratica) %}
    <div class="row">
      <div class="col-12">
        <h4 class="mt-3 mb-3">Informazioni presentate</h4>
      </div>
      <div class="col-12 col-sm-3"><strong>{{ 'pratica.dettaglio.data_ora_presentazione'|trans }}</strong></div>
      <div
        class="col-12 col-sm-9"> {{ pratica.creationTime|date(ocsdc_default_date_format) }} {{ 'pratica.dettaglio.alle'|trans }} {{ pratica.creationTime|date(ocsdc_default_time_format) }} </div>
    </div>
  {% endif %}

  <div class="row">
    <div class="col-12 col-sm-3"><strong>{{ 'pratica.dettaglio.stato'|trans }}</strong></div>
    <div class="col-12 col-sm-9"> {{ ('pratica.dettaglio.stato_'~pratica.status)|trans }}</div>
  </div>

  {% if pratica.servizio != null %}
    <div class="row">
      <div class="col-12 col-sm-3"><strong>{{ 'pratica.dettaglio.servizio'|trans }}</strong></div>
      <div class="col-12 col-sm-9">{{ pratica.servizio.name }}</div>
    </div>
  {% endif %}

  {% if pratica.ente != null %}
    <div class="row">
      <div class="col-12 col-sm-3"><strong>{{ 'pratica.dettaglio.ente'|trans }}</strong></div>
      <div class="col-12 col-sm-9"> {{ pratica.ente.name }}</div>
    </div>
  {% endif %}

  {% if pratica.dematerializedForms.data is defined and formserver_url is defined %}
  <div class="row">
    <div class="col-sm-12">
      <strong>{{ 'pratica.dettaglio.compilazione'|trans }}</strong>
    </div>
    <div class="col-sm-12 p-3">
      <div id="formio_summary" class="formio-front formio-summary"
           data-formserver_url="{{ formserver_url }}"
           data-form_id="{{ pratica.servizio.additionalData['formio_id'] }}"
           data-submission="{{ pratica.dematerializedForms.data | json_encode }}">
      </div>
    </div>
  </div>
  {% endif %}
  {{ include('AppBundle:Pratiche/summary/parts:payment_gateway.html.twig', {'pratica':pratica, 'user': user}) }}
</div>

<script type='text/javascript'>
  window.onload = function () {
    Formio.createForm(document.getElementById('formio_summary'), $('#formio_summary').data('formserver_url') + '/printable/' + $('#formio_summary').data('form_id'), {
      readOnly: true,
      noAlerts: true,
      language: 'it',
      i18n: formIoI18n
    }).then(function (form) {
      form.submission = {
        data: $('#formio_summary').data('submission')
      };
    });
  };
</script>
