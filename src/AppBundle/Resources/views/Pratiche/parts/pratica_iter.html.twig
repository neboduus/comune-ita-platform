{% set duration = pratica|iter_duration(app.request.locale) %}

<h4>{{ 'pratica.iter'|trans }}
  {% if duration != '' %}<i class="fa fa-clock-o has_tooltip" data-toggle="tooltip"
                            data-placement="top"
                            title="{{ 'pratica.tooltip_durata_iter'|trans }} {{ pratica|iter_duration }}"></i>{% endif %}
</h4>

<div class="p-2 border pt-5" style="background: #efefef">
  <div class="iter-timeline-wrapper pt-4{% if pratica.statusName == 'STATUS_COMPLETE' or pratica.statusName == 'STATUS_CANCELLED' %} done{% endif %}">
    <div class="row pt-0">
      {% for timestamp, changes in pratica.storicoStati %}
        <div class="col-12">
          <div class="timeline-element">
            <div class="it-pin-wrapper it-evidence">
              <div class="pin-icon">
                <svg class="icon">
                  <use xlink:href="/bootstrap-italia/dist/svg/sprite.svg#it-check"></use>
                </svg>
              </div>
              <div class="pin-text"><span class="p-1">{{ timestamp|date(ocsdc_default_datetime_format) }}</span></div>
            </div>
            <div class="card-wrapper">
              <div class="card no-after" style="background: #efefef">
                <div class="card-body">
                  <div class="category-top">
                    {% for change in changes[0] %}
                      {% if change is not null and change is not iterable %}
                        <a class="text-decoration-none" href="#">{{ ('pratica.dettaglio.stato_'~change)| trans }} </a>
                      {% endif %}
                    {% endfor %}
                  </div>
                  {% if changes[0][1] is defined and changes[0][1]['message'] is defined  and changes[0][1]['message'] is not null %}
                    <p class="card-text"><em>Motivo: {{ changes[0][1]['message'] }}</em></p>
                  {% endif %}
                </div>
              </div>
            </div>
          </div>
        </div>
      {% endfor %}
    </div>
  </div>
</div>
<style>.iter-timeline-wrapper .row::after {bottom: 46px;}.iter-timeline-wrapper.done .row::after {bottom: 80px;}</style>
